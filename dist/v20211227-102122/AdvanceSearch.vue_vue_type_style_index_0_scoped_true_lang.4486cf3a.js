import{u as T,B as Q}from"./useForm.05e0730a.js";import{b as w,B as C}from"./index.f3cbd9f4.js";import{S as i,a as r}from"./quotaEnum.42e6645f.js";import{b as I,h as F,v as B,ak as L}from"./index.86e9d70c.js";import{f as D,j as k,D as P,r as E,R as j,ba as R,F as N,a3 as K,a9 as A,H as U,v as V,u as b,aj as O,bv as M,m as S}from"./vendor.2e1d877b.js";import{e as H,u as z,f as $}from"./index.b2a7a6f0.js";const J=D({id:"app-quotaTree",state:()=>({sysQuotaTree:[],userQuotaTree:[]}),getters:{geteSysQuotaTree(){return this.sysQuotaTree},geteUserQuotaTree(){return this.userQuotaTree}},actions:{setSysQuotaTree(n){this.sysQuotaTree=n},setUserQuotaTree(n){this.userQuotaTree=n}}}),{t:_}=I(),W=J(),X=k(()=>[{field:"name",label:_("quota.quotaEditorModal.form.name"),required:!0,component:"Input"},{field:"categoryId",label:_("quota.quotaEditorModal.form.categoryId"),required:!0,dynamicDisabled:!0,component:"TreeSelect",componentProps:{replaceFields:{title:"name",value:"id"},optionLabelProp:"label",treeData:W.geteSysQuotaTree}},{field:"sourceCode",label:_("quota.quotaEditorModal.form.sourceCode"),component:"Input"},{field:"sourceType",label:_("quota.quotaEditorModal.form.sourceType"),required:!0,component:"Select",componentProps:{optionLabelProp:"label",options:[{label:i.wind,value:r.wind},{label:i.bloomberg,value:r.bloomberg},{label:i.reuter,value:r.reuter},{label:i.mysteel,value:r.mysteel},{label:i.cofeed,value:r.cofeed},{label:i.formula,value:r.formula},{label:i.website,value:r.website},{label:i.eia,value:r.eia},{label:i.usda,value:r.usda},{label:i.manual,value:r.manual},{label:r.other,value:r.other}]}},{field:"frequency",label:_("quota.quotaEditorModal.form.frequency"),defaultValue:"\u65E5",required:!0,component:"Select",componentProps:{options:[{value:"\u65E5"},{value:"\u5468"},{value:"\u534A\u6708"},{value:"\u6708"},{value:"\u5B63"},{value:"\u5E74"},{label:"\u5176\u4ED6",value:""}]}},{field:"shortName",label:_("quota.quotaEditorModal.form.shortName"),component:"Input"},{field:"unit",label:_("quota.quotaEditorModal.form.unit"),component:"Input"}]),oe=P({setup(n){const{t:e}=I(),{createMessage:c}=F(),u=E(0),d=E(!1),[t,{closeModal:f}]=w(a=>{u.value=a.id,o(a)}),[p,{setFieldsValue:o,validateFields:v,getFieldsValue:x,resetFields:g}]=T({schemas:X,showAdvancedButton:!0,alwaysShowLines:5,showResetButton:!1,showSubmitButton:!1,layout:"horizontal",labelCol:{span:4},wrapperCol:{span:18}}),q=j({title:e("quota.quotaEditorModal.title")});async function l(){try{await v();const a=x();a.categoryIdList=[a.categoryId],u.value!==0&&(a.id=u.value),d.value=!0,await H(a),m()}catch(a){c.error(a)}finally{d.value=!1}}async function m(){await g(),u.value=0,f()}return(a,h)=>{const s=R("loading");return N(),K(b(C),O(b(q),{onRegister:b(t),onOk:l,onCancel:m}),{default:A(()=>[U(V(b(Q),{onRegister:b(p)},null,8,["onRegister"]),[[s,d.value]])]),_:1},16,["onRegister"])}}});function se(n){const e=[];function c(t,f){const p=t.children.find(o=>(Reflect.deleteProperty(o,"class"),o.id===f));p.class=n,e.push(p)}function u(){e.forEach(t=>{Reflect.deleteProperty(t,"class")}),M(e,t=>t)}function d(t){t.class=n,e.push(t)}return[e,{setHighLight:c,clearHightLight:u,insertHightListNode:d}]}function ne({onSingleSelect:n}){const e=[];let c;const u=n;function d(o){c=o}function t(){M(e,o=>o)}function f(){return S(e)}function p({e:{nativeEvent:o,node:{eventKey:v,dataRef:x}},allowMultiSelect:g}){const q=S(e);if(o.ctrlKey&&g){const l=q.indexOf(v);l>-1?e.splice(l,1):e.push(v)}else if(o.shiftKey&&g){let l=999,m=0;const a=L(c,s=>s.id===x.categoryId).children;for(let s=0;s<e.length;s++)l=Math.min(a.findIndex(y=>y.key===e[s]),l),m=Math.max(a.findIndex(y=>y.key===e[s]),m);const h=a.findIndex(s=>s.key===v);h<l&&(l=h),h>m&&(m=h);for(let s=l;s<=m;s++){const y=a[s].key;e.indexOf(y)===-1&&e.push(y)}}else u&&u({dataRef:x,allowMultiSelect:g}),t(),e.push(v)}return[e,{insertMultiSelectedKey:p,setTreeData:d,clearMultiSelected:t,getMultiList:f}]}function re({tree:n,treeType:e}){function c(t){const f=0,p={slots:{title:"title"},name:"\u65B0\u5EFA\u6587\u4EF6\u5939",folder:!0,icon:"flat-color-icons:folder",id:f,isLeaf:!1,key:f,parentId:t.id};n[e.value].treeInstance.insertNodeByKey({parentKey:t.id,node:p,push:"unshift"});const o=n[e.value].treeInstance.getExpandedKeys();o.includes(t.id)||n[e.value].treeInstance.setExpandedKeys([...o,t.id])}async function u(t){await z({parentId:t.parentId,name:t.name,id:t.id!==0?t.id:void 0,type:e.value})}async function d(t){await $({id:t.id})}return{addFolder:c,saveCategory:u,delCategory:d}}const ue=B();export{oe as _,se as a,ne as b,re as c,ue as e,J as u};
