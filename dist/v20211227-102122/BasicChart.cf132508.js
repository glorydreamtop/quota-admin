var Ue=Object.defineProperty,Re=Object.defineProperties;var Be=Object.getOwnPropertyDescriptors;var De=Object.getOwnPropertySymbols;var Fe=Object.prototype.hasOwnProperty,Ce=Object.prototype.propertyIsEnumerable;var Ee=(e,r,t)=>r in e?Ue(e,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[r]=t,q=(e,r)=>{for(var t in r||(r={}))Fe.call(r,t)&&Ee(e,t,r[t]);if(De)for(var t of De(r))Ce.call(r,t)&&Ee(e,t,r[t]);return e},X=(e,r)=>Re(e,Be(r));import{u as Ye}from"./useECharts.5b02ea72.js";import{b as K,h as Le,_ as _e,al as Z,aR as He,ag as Je,aa as Qe,aP as Te}from"./index.86e9d70c.js";import{e as w,a as le,c as _,s as We}from"./chartEnum.d23a2dc2.js";import{D as fe,bX as Ie,R as xe,r as j,V as ye,cl as Ge,A as Q,m as P,F as O,a3 as Ve,a9 as k,K as h,L as A,u,v as L,aJ as ue,aU as ee,bG as ve,bE as ce,aH as he,H as Oe,J as Xe,am as ke,aj as $e,b0 as we,j as Ke,bF as qe,G as S,ae as U,t as Ze,cm as et,B as te,aC as de,y as $,cn as T,co as tt,cd as ge,bv as be,cp as Ae,d as je,cq as pe,cc as st,cr as Pe,Y as at,a1 as nt,aD as ot,bl as it,cs as rt,ba as lt,O as ut,P as ct,W as dt}from"./vendor.2e1d877b.js";import{l as N,k as M,q as se}from"./index.b2a7a6f0.js";import{_ as pt}from"./YAxisEditor.ca3fb716.js";/* empty css                *//* empty css                *//* empty css                *//* empty css              */import{a as mt}from"./quotaEnum.42e6645f.js";import{o as ft}from"./onMountedOrActivated.9356963a.js";var xt="/v20211227-102122/no-chart.0d656f1a.svg";const yt={class:"flex flex-col gap-1 children:whitespace-nowrap children:flex children:items-center w-30"},vt={class:"w-3em text-justify mr-2"},ht={class:"min-w-3em text-justify mr-2"},wt={class:"min-w-3em text-justify mr-2"},gt={class:"min-w-3em text-justify mr-2"},bt={class:"min-w-3em text-justify mr-2"},At={class:"min-w-3em text-justify mr-2"},Dt={class:"min-w-3em text-justify mr-2"},Et={class:"min-w-3em text-justify mr-2"},Lt={class:"mt-2 flex gap-1"},_t=fe({props:{chartConfig:null,idx:null},emits:["update","visibleChange"],setup(e,{expose:r,emit:t}){const n=e,{t:a}=K(),s=Ie.Group,l=Ie.Button,{createMessage:p}=Le(),o=xe({min:void 0,max:void 0,inverse:!1,offset:0,axisLine:{show:!0},position:"left",axisLabel:{formatter:"{value}"}}),i=j(0),d={left:"right",right:"left"},c=j("right");function f(x,y){if(x.target.value===""){o[y]=void 0;return}o[y]=parseFloat(x.target.value.replace(/[^\d|\.]/g,""))}const m=j(!1);function D(x){m.value=x}r({setVisible:D}),ye(m,x=>{var y,v,V,z;if(x){if(n.idx===null){const[re,E]=Ge(n.chartConfig.yAxis,ze=>ze.position==="left"),I=re.length<E.length,G=(I?(v=(y=Q(E))==null?void 0:y.offset)!=null?v:-40:(z=(V=Q(re))==null?void 0:V.offset)!=null?z:-40)+40;Object.assign(o,{min:void 0,max:void 0,inverse:!1,offset:G,axisLine:{show:!0},position:I?"left":"right",axisLabel:{formatter:"{value}"}})}else Object.assign(o,P(n.chartConfig.yAxis[n.idx]));c.value=d[o.position];const ie=n.chartConfig.yAxis[n.idx].axisLabel.formatter;i.value=/pow/i.test(ie)?parseInt(ie.match(/\d+/i)[0]):0}t("visibleChange",x)});function g(){const x=P(n.chartConfig);i.value>0?o.axisLabel.formatter=`pow${i.value}`:o.axisLabel.formatter="{value}",n.idx===null?x.yAxis.push(o):Object.assign(x.yAxis[n.idx],o),t("update",x),D(!1)}function b(){const x=P(n.chartConfig),y=x.quotaList.find(v=>v.setting.yAxisIndex===n.idx);if(y){p.warn(`[${y.name}]`+a("quotaView.advance.axisSetting.yAxis.cannotdel"));return}if(x.yAxis.length===1){p.warn(a("quotaView.advance.axisSetting.yAxis.lastnotdel"));return}x.yAxis.splice(n.idx,1),t("update",x),D(!1)}return(x,y)=>(O(),Ve(u(we),$e(x.$attrs,{trigger:"click",visible:m.value,"onUpdate:visible":y[10]||(y[10]=v=>m.value=v),placement:c.value,destroyTooltipOnHide:""}),{content:k(()=>[h("div",yt,[h("div",null,[h("div",vt,A(u(a)("quotaView.advance.axisSetting.yAxis.index")),1),h("span",null,A(e.idx>-1?e.idx+1:""),1)]),h("div",null,[h("div",ht,A(u(a)("quotaView.advance.axisSetting.yAxis.min")),1),L(u(ue),{size:"small",class:"!w-59px !min-w-59px",value:u(o).min,"onUpdate:value":y[0]||(y[0]=v=>u(o).min=v),onInput:y[1]||(y[1]=v=>f(v,"min"))},null,8,["value"])]),h("div",null,[h("div",wt,A(u(a)("quotaView.advance.axisSetting.yAxis.max")),1),L(u(ue),{size:"small",class:"!w-59px !min-w-59px",value:u(o).max,"onUpdate:value":y[2]||(y[2]=v=>u(o).max=v),onInput:y[3]||(y[3]=v=>f(v,"max"))},null,8,["value"])]),h("div",null,[h("div",gt,A(u(a)("quotaView.advance.axisSetting.yAxis.position")),1),L(u(s),{size:"small",value:u(o).position,"onUpdate:value":y[4]||(y[4]=v=>u(o).position=v),"button-style":"solid"},{default:k(()=>[L(u(l),{value:"left"},{default:k(()=>[ee(A(u(a)("quotaView.advance.axisSetting.yAxis.left")),1)]),_:1}),L(u(l),{value:"right"},{default:k(()=>[ee(A(u(a)("quotaView.advance.axisSetting.yAxis.right")),1)]),_:1})]),_:1},8,["value"])]),h("div",null,[h("div",bt,A(u(a)("quotaView.advance.axisSetting.yAxis.inverse")),1),L(u(ve),{size:"small",checked:u(o).inverse,"onUpdate:checked":y[5]||(y[5]=v=>u(o).inverse=v)},null,8,["checked"])]),h("div",null,[h("div",At,A(u(a)("quotaView.advance.axisSetting.yAxis.showLine")),1),L(u(ve),{size:"small",checked:u(o).axisLine.show,"onUpdate:checked":y[6]||(y[6]=v=>u(o).axisLine.show=v)},null,8,["checked"])]),h("div",null,[h("div",Dt,A(u(a)("quotaView.advance.valueFormatter.scientificNotation")),1),L(u(ce),{size:"small",class:"!w-59px !min-w-59px",min:0,value:i.value,"onUpdate:value":y[7]||(y[7]=v=>i.value=v)},null,8,["value"])]),h("div",null,[h("div",Et,A(u(a)("quotaView.advance.axisSetting.yAxis.offset")),1),L(u(ue),{size:"small",class:"!w-59px !min-w-59px",value:u(o).offset,"onUpdate:value":y[8]||(y[8]=v=>u(o).offset=v),onInput:y[9]||(y[9]=v=>f(v,"offset"))},null,8,["value"])]),h("div",Lt,[L(u(he),{size:"small",block:"",type:"primary",onClick:g},{default:k(()=>[ee(A(u(a)("common.okText")),1)]),_:1}),Oe(L(u(he),{size:"small",block:"",type:"primary",danger:"",onClick:b},{default:k(()=>[ee(A(u(a)("common.removeText")),1)]),_:1},512),[[Xe,n.idx!==null]])])])]),default:k(()=>[h("div",null,[ke(x.$slots,"default")])]),_:3},16,["visible","placement"]))}});const Tt={class:"flex flex-col gap-1 children:whitespace-nowrap children:flex children:items-center w-40"},It={class:"text-primary"},Vt={class:"w-4em text-justify mr-2"},Ot={key:0},kt={class:"w-4em text-justify mr-2"},$t={key:1},qt={class:"w-4em text-justify mr-2"},jt={key:2},Pt={class:"w-4em text-justify mr-2"},St={key:3},Nt={class:"w-4em text-justify mr-2"},Mt={key:4},zt={class:"w-4em text-justify mr-2"},Ut={class:"mt-2 flex gap-1"},Rt=fe({props:{chartConfig:null,seriesInfo:null,options:null},emits:["update","visibleChange"],setup(e,{expose:r,emit:t}){const n=e,{t:a}=K(),s=xe({name:"",size:void 0,seriesType:w.line,lineType:void 0,shadow:void 0,yAxisIndex:void 0,xAxisIndex:void 0}),l=Ke(()=>({yAxisMax:n.chartConfig.yAxis.length})),p=xe({seriesTypeList:[w.line,w.bar,w.scatter,w.smoothLine,w.area,w.radar,w.pie].map(c=>({label:a(`quotaView.seriesEdit.seriesTypeList.${c}`),value:c})),lineTypeList:[le.solid,le.dashed,le.dotted].map(c=>({label:a(`quotaView.seriesEdit.lineTypeList.${c}`),value:c}))}),o=j(!1);function i(c){o.value=c}r({setVisible:i}),ye(o,c=>{c&&Wt(s,n.chartConfig.type,n.seriesInfo,n.options),t("visibleChange",c)});function d(){const c=P(n.chartConfig),f=c.seriesSetting.find(D=>D.name===s.name),m=P(Ze(s));m.yAxisIndex-=1,m.xAxisIndex-=1,f?et(f,m):c.seriesSetting.push(m),t("update",c),i(!1)}return(c,f)=>(O(),Ve(u(we),$e(c.$attrs,{trigger:"click",visible:o.value,"onUpdate:visible":f[6]||(f[6]=m=>o.value=m),destroyTooltipOnHide:""}),{content:k(()=>[h("div",Tt,[h("span",It,A(u(s).name),1),h("span",null,[h("span",Vt,A(u(a)("quotaView.seriesEdit.seriesType")),1),L(u(qe),{class:"!w-6em",size:"small",value:u(s).seriesType,"onUpdate:value":f[0]||(f[0]=m=>u(s).seriesType=m),options:u(p).seriesTypeList},null,8,["value","options"])]),u(s).lineType!==void 0?(O(),S("span",Ot,[h("span",kt,A(u(a)("quotaView.seriesEdit.lineType")),1),L(u(qe),{class:"!w-6em",size:"small",value:u(s).lineType,"onUpdate:value":f[1]||(f[1]=m=>u(s).lineType=m),options:u(p).lineTypeList},null,8,["value","options"])])):U("",!0),u(s).size!==void 0?(O(),S("span",$t,[h("span",qt,A(u(a)("quotaView.seriesEdit.lineWidth")),1),L(u(ce),{step:2,class:"!text-center",size:"small",value:u(s).size,"onUpdate:value":f[2]||(f[2]=m=>u(s).size=m)},null,8,["value"])])):U("",!0),u(s).shadow!==void 0?(O(),S("span",jt,[h("span",Pt,A(u(a)("quotaView.seriesEdit.lineShadow")),1),L(u(ve),{size:"small",checked:u(s).shadow,"onUpdate:checked":f[3]||(f[3]=m=>u(s).shadow=m)},null,8,["checked"])])):U("",!0),u(s).yAxisIndex!==void 0?(O(),S("span",St,[h("span",Nt,A(u(a)("quotaView.seriesEdit.yAxisIndex")),1),L(u(ce),{class:"!w-3em !text-center",size:"small",value:u(s).yAxisIndex,"onUpdate:value":f[4]||(f[4]=m=>u(s).yAxisIndex=m),max:u(l).yAxisMax,min:1},null,8,["value","max"])])):U("",!0),u(s).xAxisIndex!==void 0?(O(),S("span",Mt,[h("span",zt,A(u(a)("quotaView.seriesEdit.xAxisIndex")),1),L(u(ce),{class:"!w-3em !text-center",size:"small",value:u(s).xAxisIndex,"onUpdate:value":f[5]||(f[5]=m=>u(s).xAxisIndex=m)},null,8,["value"])])):U("",!0),h("div",Ut,[L(u(he),{size:"small",block:"",type:"primary",onClick:d},{default:k(()=>[ee(A(u(a)("common.okText")),1)]),_:1})])])]),default:k(()=>[h("div",null,[ke(c.$slots,"default",{},void 0,!0)])]),_:3},16,["visible"]))}});var Bt=_e(Rt,[["__scopeId","data-v-38d0fb0f"]]);const{t:R}=K(),ae="mount-node";function Se(e){var a;const{clientX:r,clientY:t}=(a=e.event)==null?void 0:a.event,n=document.createElement("span");return n.className=ae,Object.assign(n.style,{position:"fixed",top:`${t}px`,left:`${r}px`,zIndex:"19"}),document.body.appendChild(n),n}function Ft({onOk:e,chartConfig:r}){const t=j("");return function(n){t.value=r.title;function a(){return te(ue,{style:{width:"200px"},defaultValue:t,onChange:function(l){t.value=l.target.value}})}const s=te(we,{content:a(),defaultVisible:!0,trigger:"click",destroyTooltipOnHide:!0,getPopupContainer:l=>n,onVisibleChange:l=>{l||(e(t.value),n.className===ae&&n.remove())}});de(s,n)}}function Ct({chartConfig:e,onOk:r}){return function(t,{yAxisIndex:n}){const a=n;function s(){return te(pt,{chartConfig:e,idx:a,onVisibleChange:o=>{!o&&t.className===ae&&t.remove()},onUpdate:o=>{r(o)},getPopupContainer:()=>t})}const l=s();de(l,t),l.component.exposed.setVisible(!0)}}function Yt({chartConfig:e,onOk:r}){return function(t,{xAxisIndex:n}){const a=n;function s(){return te(_t,{chartConfig:e,idx:a,onVisibleChange:o=>{!o&&t.className===ae&&t.remove()},onUpdate:o=>{r(o)},getPopupContainer:()=>t})}const l=s();de(l,t),l.component.exposed.setVisible(!0)}}function Ne(e,r,t){const n=`${t}
`+e.map(d=>{const c=d.diff?d.diff>0?`{more|${d.diff}}`:`{less|${d.diff}}`:"",f=`{val|${d.value}}`;return`${d.name} [${d.date}] ${f} ${c}`}).join(`
`),a=document.createElement("div");Object.assign(a.style,{fontSize:"13px",fontFamily:"Microsoft YaHei",lineHeight:"18px",position:"absolute"}),a.innerText=n.replaceAll(/\{|}|less|more|val|\|/g,""),document.getElementById("app").append(a);const s=a.clientWidth,l=a.clientHeight;a.remove();const p=Q(r.graphic.elements),o=p?p.left+p.shape.width+10:80,i={type:"group",left:o,top:"10%",draggable:!0,shape:{width:s+10,height:l+10},children:[{type:"rect",z:100,left:0,top:0,shape:{x:0,y:0,width:s+10,height:l+10},style:{fill:"#ffffff66",stroke:"#555",borderColor:"#ffffff99",borderWidth:1,shadowBlur:8,lineWidth:0,shadowOffsetX:3,shadowOffsetY:3,shadowColor:"rgba(0,0,0,0.2)"}},{type:"text",z:100,left:10,top:10,style:{fill:"#333",text:n,font:"12px Microsoft YaHei",rich:{val:{fill:"#000",fontWeight:"bold",fontSize:"12px",height:20},more:{fill:"#DC143C",height:20},less:{fill:"#008000",height:20}}}}]};r.graphic.elements.push(i)}async function B({chartConfig:e,quotaDataList:r,options:t}){const n=[_.seasonal,_.seasonalLunar];if(e.showLastest){const a=[];if(n.includes(e.type)){const s=$(Q(r[0].data)[0]).year(2020).unix()*1e3,l=t.series;l.forEach((p,o)=>{const i=p.data;for(let d=0;d<i.length;d++){const c=i[d];if(c[0]<=s&&s<(i[d+1]||i[d])[0]){a.push({name:p.name,date:Z(c[0],"MM-DD"),value:c[1],diff:T(d>0?c[1]-i[d-1][1]:c[1]-Q(l[o-1].data)[1],e.valueFormatter.afterDot)});break}}})}else{let s=function(l){return e.type===_.structural?(l=parseInt(l),Te(l,e.timeConfig.endDate)):l};r.forEach(l=>{const p=Q(l.data);a.push({name:l.name,date:Z(s(p[0]),"MM-DD"),value:T(p[1],e.valueFormatter.afterDot),diff:function(){return l.data.length>1?T(p[1]-tt(l.data,-2)[1],e.valueFormatter.afterDot):NaN}()})})}Ne(a,t,R("quotaView.advance.rectSetting.lastest"))}}async function ne({chartConfig:e,quotaDataList:r,options:t}){const n=[_.seasonal,_.seasonalLunar];if(e.showHighest){const a=[];n.includes(e.type)?t.series.forEach(l=>{const p=l.data,o=ge(p,i=>i[1]);a.push({name:l.name,date:Z(o[0],"MM-DD"),value:o[1]})}):r.forEach(s=>{const l=ge(s.data,p=>p[1]);a.push({name:s.name,date:Z(l[0],"MM-DD"),value:l[1]})}),Ne(a,t,R("quotaView.advance.rectSetting.highest"))}}function F({options:e}){Object.assign(e,{graphic:{elements:[]}})}function Me({chartConfig:e,quotaDataList:r}){const t=e.timeConfig.sortMonth;!t||t.length===0||r.forEach(n=>{n.data=n.data.filter(a=>!t.includes($(a[0]).month()+1))})}function Ht({chartConfig:e,series:r,legend:t}){const n=e.timeConfig.sortYear;!n||n.length===0||(be(r,a=>n.includes(a.name)),be(t.data,a=>n.includes(a)))}function Jt({chartConfig:e}){const r=[{text:e.title,left:"center",triggerEvent:!0}],t=e.timeConfig.pastValue;for(let n=0;n<t;n++){const a={subtext:oe(t,n),left:`${100/(t+1)*(n+1)}%`,top:"80%",textAlign:"center"};r.push(a)}return{title:r}}function oe(e,r,t=!0){if(t){const n=e-r-1;return n===0?R("common.last"):R("quotaView.chart.inserveIndex")+n+R("quotaView.chart.unit")}else return R("quotaView.chart.inserveIndex")+`${r+1}`+R("quotaView.chart.unit")}function Qt({onOk:e,chartConfig:r}){return function(t,n,a){console.log(n);function s(){return te(Bt,{chartConfig:r,seriesInfo:n,options:a,onVisibleChange:o=>{!o&&t.className===ae&&t.remove()},onUpdate:o=>{e(o)},getPopupContainer:()=>t})}const l=s();de(l,t),l.component.exposed.setVisible(!0)}}function C({chartConfig:e,quotaDataList:r}){if(!e.valueFormatter.normalized)return;const t=e.valueFormatter.afterDot;r.forEach(n=>{const a=n.data[0][1];n.data.forEach(s=>{s[1]=T(s[1]/a,t)})})}async function Y({chartConfig:e}){const r=e.colorSchemeId,t=e.selfColorScheme.split(",");if(r){const{colors:n}=await He({id:r});return n.split(",").map((s,l)=>t[l]===void 0||!t[l].includes("#")?s:t[l])}else return t}function me(e){const r=P(e),t=r.axisLabel.formatter;if(/pow/i.test(t)){const n=parseInt(t.match(/\d+/i)[0]);r.axisLabel.formatter=a=>a/Math.pow(10,n),r.name=`10e${n}`,r.axisLine.symbol=["none","arrow"]}return r}function Wt(e,r,t,n){var l,p,o,i;const a=t.seriesIndex,s=n.series[a];switch(r){case _.normal:e.name=s.name,s.type==="line"?(Ae(s,"areaStyle")?e.seriesType=w.area:s.smooth===!0?e.seriesType=w.smoothLine:s.smooth===!1&&(e.seriesType=w.line),e.size=s.lineStyle.width,e.lineType=s.lineStyle.type,e.shadow=s.lineStyle.shadowColor!==void 0):s.type==="bar"&&(e.seriesType=w.bar),e.yAxisIndex=s.yAxisIndex+1,e.xAxisIndex=s.xAxisIndex+1;break;case _.seasonal:e.name=s.name,s.type==="line"?(Ae(s,"areaStyle")?e.seriesType=w.area:s.smooth===!0?e.seriesType=w.smoothLine:s.smooth===!1&&(e.seriesType=w.line),e.size=s.lineStyle.width,e.lineType=s.lineStyle.type,e.shadow=s.lineStyle.shadowColor!==void 0):s.type==="bar"&&(e.seriesType=w.bar),e.yAxisIndex=((l=s.yAxisIndex)!=null?l:0)+1,e.xAxisIndex=((p=s.xAxisIndex)!=null?p:0)+1;case _.bar:s.type==="line"?(Ae(s,"areaStyle")?e.seriesType=w.area:s.smooth===!0?e.seriesType=w.smoothLine:s.smooth===!1&&(e.seriesType=w.line),e.size=s.lineStyle.width,e.lineType=s.lineStyle.type,e.shadow=s.lineStyle.shadowColor!==void 0):s.type==="bar"&&(e.name=t.seriesName,e.seriesType=w.bar,e.shadow=s.lineStyle.shadowColor!==void 0),e.yAxisIndex=((o=s.yAxisIndex)!=null?o:0)+1,e.xAxisIndex=((i=s.xAxisIndex)!=null?i:0)+1}}function Gt(e,r,t){var l;function n(){var o,i;const p={width:(o=t==null?void 0:t.size)!=null?o:2,type:(i=t==null?void 0:t.lineType)!=null?i:le.solid};return(t==null?void 0:t.shadow)&&Object.assign(p,{shadowBlur:2,shadowColor:r[e.findIndex(d=>d.name===(t==null?void 0:t.name))],shadowOffsetX:2,shadowOffsetY:2}),p}function a(){var p,o;return{xAxisIndex:(p=t==null?void 0:t.xAxisIndex)!=null?p:0,yAxisIndex:(o=t==null?void 0:t.yAxisIndex)!=null?o:0}}return{[w.line]:X(q({type:"line",symbol:"none",lineStyle:n()},a()),{triggerLineEvent:!0}),[w.smoothLine]:X(q({type:"line",smooth:!0,symbol:"none",lineStyle:n()},a()),{triggerLineEvent:!0}),[w.area]:X(q({type:"line",smooth:!1,symbol:"none",areaStyle:{},lineStyle:n()},a()),{triggerLineEvent:!0}),[w.scatter]:{type:"scatter"},[w.bar]:q({type:"bar"},a())}[(l=t==null?void 0:t.seriesType)!=null?l:w.line]}function Xt({chartConfig:e,quotaDataList:r}){const t=e.removePoint;if(console.log(t),t!==void 0&&t.length>0){const n={};if(t==null||t.forEach(a=>{const s=a.xRange.split(",");n[a.seriesName]=s}),t===void 0||t.length===0)return;r.forEach(a=>{if(Reflect.has(n,a.name)){const s=n[a.name].map(l=>{if(/x=\d{4}-\d{2}-\d{2}/i.test(l))return $(l.split("=")[1]).unix()*1e3;if(/\d{4}-\d{2}-\d{2}<x<\d{4}-\d{2}-\d{2}/i.test(l))return l.split("<x<").map(p=>$(p).unix()*1e3)});s.length>0&&(console.log(s[0]),a.data=a.data.filter(l=>{const p=$(l[0]).startOf("d").unix()*1e3;for(let o=0;o<s.length;o++){const i=s[o];if(Je(i)&&i===p||Qe(i)&&p>i[0]&&p<i[1])return!1}return console.log(p),!0}))}})}}const{t:Kt}=K();function W(e){return{text:e.title,left:"center",triggerEvent:!0}}const H={},J={width:"auto"};async function Zt(e){var d;const r=q({exportPara:N.JSON,rows:e.quotaList},je(e.timeConfig,["startDate","endDate"])),t=await M(r);Me({chartConfig:e,quotaDataList:t}),C({chartConfig:e,quotaDataList:t});const n=[],a={data:[],top:"bottom",icon:"roundRect"},s=t[0],l=e.timeConfig.startMonth,p=l>1;s.data.forEach(c=>{var v;const f=c[0],m=$(f).year(),D=$(f).month(),g=T(c[1],e.valueFormatter.afterDot);let b,x;p?D<l-1?(b=2020,x=`${m-1}-${m}`):(b=2019,x=`${m}-${m+1}`):(x=`${m}`,b=2020);const y=n.find(V=>V.name===x);y?y.data.push([$(f).year(b).hour(0).unix()*1e3,g]):((v=a.data)==null||v.push(x),n.push({name:x,symbol:"none",type:"line",connectNulls:!1,triggerLineEvent:!0,data:[[$(f).year(b).hour(0).unix()*1e3,g]]}))});const o=(await Y({chartConfig:e})).slice(0,n.length).reverse();for(let c=0;c<3;c++)n[n.length-c-1].lineStyle={width:3,shadowBlur:4,shadowColor:o[n.length-c-1],shadowOffsetX:0,shadowOffsetY:2};Ht({chartConfig:e,series:n,legend:a});const i={title:W(e),xAxis:{type:"time",axisLabel:{formatter:"{MM}/{dd}"},triggerEvent:!0},yAxis:(d=e.yAxis)==null?void 0:d.map(c=>{const f=me(c),m={type:"value",scale:!0,show:!0,triggerEvent:!0};return Object.assign(m,f),m}),legend:a,color:o,series:n,toolbox:H,tooltip:{show:!0,trigger:"axis",axisPointer:{label:{formatter:({value:c})=>Z(c,"MM/DD")}}},grid:J};return F({options:i}),B({chartConfig:e,options:i,quotaDataList:t}),ne({chartConfig:e,options:i,quotaDataList:t}),i}async function es(e){var p;const r=q({exportPara:N.JSON,rows:e.quotaList},je(e.timeConfig,["startDate","endDate","pastValue","pastUnit"])),t=await M(r);Me({chartConfig:e,quotaDataList:t}),C({chartConfig:e,quotaDataList:t}),Xt({chartConfig:e,quotaDataList:t});const n={data:[],top:"bottom",icon:"roundRect"},a=[],s=await Y({chartConfig:e});t.forEach(o=>{n.data.push(o.name);const i=e.seriesSetting.find(d=>d.name===o.name);o.data.forEach(d=>d[1]=T(d[1],e.valueFormatter.afterDot)),a.push(X(q({name:o.name},Gt(t,s,i)),{data:o.data}))});const l={title:W(e),xAxis:{type:"time",triggerEvent:!0},yAxis:(p=e.yAxis)==null?void 0:p.map(o=>{const i=me(o),d={type:"value",scale:!0,show:!0,triggerEvent:!0};return Object.assign(d,i),d}),color:s,legend:n,series:a,toolbox:H,tooltip:{show:!0,trigger:"axis"},grid:J};return F({options:l}),B({chartConfig:e,options:l,quotaDataList:t}),ne({chartConfig:e,options:l,quotaDataList:t}),l}async function ts(e){var i;const r={startDate:e.timeConfig.startDate,endDate:e.timeConfig.endDate,exportPara:N.JSON,rows:e.quotaList,pastUnit:se.last,pastValue:e.timeConfig.pastValue},t=await M(r);C({chartConfig:e,quotaDataList:t});const n=[],a={source:[]};let s=0;for(let d=0;d<t.length;d++)s=pe([t[d].data.length,s]);const l=["qoutaName"];for(let d=0;d<s;d++)n.push({type:"bar",seriesLayoutBy:"column"}),l.push(oe(s,d));a.source=[l],t.forEach(d=>{const c=[d.name,...d.data.map(f=>T(f[1],e.valueFormatter.afterDot))];a.source.push(c)});const p=await Y({chartConfig:e}),o={title:W(e),xAxis:{type:"category",axisTick:{alignWithLabel:!0},triggerEvent:!0},yAxis:(i=e.yAxis)==null?void 0:i.map(d=>{const c=me(d),f={type:"value",scale:!0,show:!0,triggerEvent:!0};return Object.assign(f,c),f}),dataset:a,color:p,series:n,legend:{top:"bottom",icon:"roundRect"},toolbox:H,tooltip:{show:!0,trigger:"axis",axisPointer:{type:"none"}},grid:J};return F({options:o}),B({chartConfig:e,options:o,quotaDataList:t}),ne({chartConfig:e,options:o,quotaDataList:t}),o}async function ss(e){var p,o;const r={startDate:e.timeConfig.startDate,endDate:e.timeConfig.endDate,exportPara:N.JSON,rows:e.quotaList,pastUnit:se.last,pastValue:e.timeConfig.pastValue},t=await M(r);C({chartConfig:e,quotaDataList:t});const n=[{type:"radar",data:[]}];for(let i=0;i<e.timeConfig.pastValue;i++)n[0].data.push({value:[],name:oe(e.timeConfig.pastValue,i)});const a={indicator:[],axisTick:{show:!0},axisLabel:{show:!0,formatter:function(i){return T(i,e.valueFormatter.afterDot).toString()}}};for(let i=0;i<t.length;i++){const d=t[i];a.indicator.push({text:d.name,max:((p=ge(d.data,c=>c[1]))!=null?p:[0,0])[1]*1.02,min:((o=st(d.data,c=>c[1]))!=null?o:[0,0])[1]*.95});for(let c=0;c<d.data.length;c++){const f=d.data[c];n[0].data[c].value.push(f[1])}}const s=await Y({chartConfig:e}),l={title:W(e),radar:a,series:n,color:s,legend:{top:"bottom",icon:"roundRect"},toolbox:H,tooltip:{show:!0,trigger:"item",axisPointer:{type:"none"}},grid:J};return F({options:l}),B({chartConfig:e,options:l,quotaDataList:t}),l}async function as(e){var o;const r=e.structuralOffset.split(",").map(i=>parseInt(i)),t=[];if(e.structuralOffsetUnit===We.natureDay)for(let i=0;i<r.length;i++){const d=r[i],c={startDate:e.timeConfig.startDate,endDate:Te(d,e.timeConfig.endDate),exportPara:N.JSON,rows:e.quotaList,pastUnit:se.last,pastValue:1},f=await M(c);f.forEach(m=>{m.data[0][0]=`-${d}D`}),t.length===0?t.push(...f):t.forEach((m,D)=>{m.data.push(f[D].data[0])})}else{const i=pe(r),d={startDate:e.timeConfig.startDate,endDate:e.timeConfig.endDate,exportPara:N.JSON,rows:e.quotaList,pastUnit:se.last,pastValue:i+1},c=await M(d);c.forEach(f=>{be(f.data,(m,D)=>{const g=f.data.length-D-1;return m[0]=`-${g}D`,!r.includes(g)})}),t.push(...c)}C({chartConfig:e,quotaDataList:t});const n=[],a={source:[]},s=["qoutaName"];for(let i=0;i<r.length;i++)n.push({type:"line",seriesLayoutBy:"column"}),s.push(`-${r[i]}D`);a.source=[s],t.forEach(i=>{const d=[i.name,...i.data.map(c=>T(c[1],e.valueFormatter.afterDot))];a.source.push(d)});const l=await Y({chartConfig:e}),p={title:W(e),xAxis:{type:"category",axisTick:{alignWithLabel:!0},triggerEvent:!0},yAxis:(o=e.yAxis)==null?void 0:o.map(i=>{const d=me(i),c={type:"value",scale:!0,show:!0,triggerEvent:!0};return Object.assign(c,d),c}),dataset:a,color:l,series:n,legend:{top:"bottom",icon:"roundRect"},toolbox:H,tooltip:{show:!0,trigger:"axis",axisPointer:{type:"none"}},grid:J};return F({options:p}),B({chartConfig:e,options:p,quotaDataList:t}),ne({chartConfig:e,options:p,quotaDataList:t}),p}async function ns(e){const r={startDate:e.timeConfig.startDate,endDate:e.timeConfig.endDate,exportPara:N.JSON,rows:e.quotaList,pastUnit:se.last,pastValue:e.timeConfig.pastValue},t=await M(r);C({chartConfig:e,quotaDataList:t});const n=[],a={source:[]};let s=0;for(let i=0;i<t.length;i++)s=pe([t[i].data.length,s]);const l=["qoutaName"];for(let i=0;i<s;i++)n.push({type:"pie",radius:`${Pe([90/s,60])}%`,center:[`${100/(s+1)*(i+1)}%`,"50%"],encode:{itemName:"qoutaName",value:oe(s,i)},seriesLayoutBy:"column"}),l.push(oe(s,i));a.source=[l],t.forEach(i=>{const d=[i.name,...i.data.map(c=>T(c[1],e.valueFormatter.afterDot))];a.source.push(d)});const p=await Y({chartConfig:e}),o={title:Jt({chartConfig:e}).title,dataset:a,color:p,series:n,legend:{top:"bottom",icon:"roundRect"},toolbox:H,tooltip:{show:!0,trigger:"item",axisPointer:{type:"none"}},grid:J};return F({options:o}),B({chartConfig:e,options:o,quotaDataList:t}),ne({chartConfig:e,options:o,quotaDataList:t}),o}async function os(e){const r=[],t=e.quantileOffset.split(",");for(let m=0;m<t.length;m++){const D=t[m];e.quotaList.forEach(g=>{const b=P(g);b.sourceType=mt.formula,b.sourceCode=`pct(idx(${g.id}),${parseInt(D)*250})`,Reflect.deleteProperty(b,"id"),r.push(b)})}const n={startDate:e.timeConfig.startDate,endDate:e.timeConfig.endDate,exportPara:N.JSON,rows:r,lastFlag:!0},a=await M(n);a.forEach(m=>{m.data.forEach(D=>T(D[1],e.valueFormatter.afterDot))}),C({chartConfig:e,quotaDataList:a});const s=[{type:"radar",data:[]}];for(let m=0;m<t.length;m++)s[0].data.push({value:[],name:`${t[m]}${Kt("quotaView.chart.quantile")}`});const l={indicator:[],axisTick:{show:!0},axisLabel:{show:!0,formatter:function(m){return T(m,e.valueFormatter.afterDot).toString()}}},p=e.quotaList.length,o=new Array(p).fill(-1),i=new Array(p).fill(1/0),d=s[0].data;for(let m=0;m<a.length;m++){const g=a[m].data[0];g[1]=T(g[1],e.valueFormatter.afterDot);const b=m%p;o[b]=pe([(g!=null?g:[0,0])[1]*1.02,o[b]]),i[b]=Pe([(g!=null?g:[0,0])[1]*.95,i[b]]);for(let x=0;d.length;x++)if(d[x].value.length<p){d[x].value.push(g[1]);break}}for(let m=0;m<p;m++)l.indicator.push({text:e.quotaList[m].name,max:o[m],min:i[m]});const c=await Y({chartConfig:e}),f={title:W(e),radar:l,color:c,series:s,legend:{top:"bottom",icon:"roundRect"},toolbox:H,tooltip:{show:!0,trigger:"item",axisPointer:{type:"none"}},grid:J};return F({options:f}),B({chartConfig:e,options:f,quotaDataList:a}),f}const is=e=>(ut("data-v-2362222a"),e=e(),ct(),e),rs={class:"h-full overflow-hidden relative"},ls={key:0,class:"no-chart flex flex-col items-center"},us=is(()=>h("img",{src:xt},null,-1)),cs={key:0,class:"whitespace-nowrap mt-2 text-gray-400"},ds=fe({props:{config:null},emits:["updateConfig","paintSuccess"],setup(e,{expose:r,emit:t}){const n=e,{config:a}=at(n),s=j(),{setOptions:l,resize:p,getInstance:o}=Ye(s),{createMessage:i}=Le(),{t:d}=K(),c=j(!0),f={[_.seasonal]:Zt,[_.normal]:es,[_.bar]:ts,[_.normalRadar]:ss,[_.structural]:as,[_.pie]:ns,[_.quantileRadar]:os},m=j(!1);r({getInstance:o}),ye(a,async x=>{var y,v;if(!(!Reflect.has(x,"quotaList")||((y=x.quotaList)==null?void 0:y.length)===0))try{m.value=!0,(v=o())==null||v.on("finished",function(){nt(()=>{var z;t("paintSuccess",o().getOption()),(z=o())==null||z.off("finished")})});const V=await f[x.type](x);V.animationEasing="quinticIn",l(V),c.value=!1}catch(V){console.log(V),c.value=!0,i.warn(d("common.renderError"))}finally{m.value=!1}},{deep:!0,immediate:!0});function D(x){x.preventDefault()}function g(){t("updateConfig",P(u(a)))}const b=[];return ft(()=>{const x=o(),y=dt(p,100),{stop:v}=ot(u(s),()=>{y()});it(()=>{v()}),rt(()=>{v()});const V=Ft({chartConfig:a.value,onOk:E=>{a.value.title=E,g()}});b.push({event:V,eventType:"dblclick",target:"title"});const z=Ct({chartConfig:a.value,onOk:E=>{Object.assign(a.value,E),g()}});b.push({event:z,eventType:"contextmenu",target:"yAxis"});const ie=Yt({chartConfig:a.value,onOk:E=>{Object.assign(a.value,E),g()}});b.push({event:ie,eventType:"contextmenu",target:"xAxis"});const re=Qt({chartConfig:a.value,onOk:E=>{Object.assign(a.value,E),g()}});b.push({event:re,eventType:"contextmenu",target:"series"}),x.on("dblclick",E=>{b.filter(I=>I.eventType==="dblclick").forEach(I=>{if(E.componentType===I.target){const G=Se(E);I.event(G,E)}})}),x.on("contextmenu",E=>{b.filter(I=>I.eventType==="contextmenu").forEach(I=>{if(E.componentType===I.target){const G=Se(E);console.log(x.getOption()),I.event(G,E,x.getOption())}})})}),(x,y)=>{const v=lt("loading");return Oe((O(),S("div",rs,[h("div",{ref_key:"chartElRef",ref:s,class:"w-full h-full",onContextmenu:D},null,544),c.value?(O(),S("div",ls,[us,u(a).title?(O(),S("span",cs,A(u(a).title),1)):U("",!0)])):U("",!0)])),[[v,m.value]])}}});var Ls=_e(ds,[["__scopeId","data-v-2362222a"]]);export{Ls as B};
