var De=Object.defineProperty,Ie=Object.defineProperties;var Se=Object.getOwnPropertyDescriptors;var X=Object.getOwnPropertySymbols;var Le=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable;var W=(o,s,t)=>s in o?De(o,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[s]=t,J=(o,s)=>{for(var t in s||(s={}))Le.call(s,t)&&W(o,t,s[t]);if(X)for(var t of X(s))we.call(s,t)&&W(o,t,s[t]);return o},Y=(o,s)=>Ie(o,Se(s));import{_ as Z}from"./Tree.vue_vue_type_style_index_0_lang.cce92993.js";import{bv as ee,m as te,bw as ae,o as Ne,D as se,Y as ke,bd as ne,r as M,R as oe,u as l,a$ as re,a0 as Ee,ba as ie,F as w,G as Me,a3 as R,ae as Re,H as le,v as N,a9 as k,aj as ce,K as qe,L as je,a1 as Fe,d as Pe,aJ as He,bx as Oe,W as Ke}from"./vendor.2e1d877b.js";/* empty css               */import{aj as ue,b as A,ak as fe,al as Ae,_ as de,I as U,am as pe,an as Ue,h as me}from"./index.86e9d70c.js";import{C as _}from"./quotaEnum.42e6645f.js";import{u as he}from"./useTimeout.534f4a33.js";import{v as D,t as Be,s as ge}from"./chartEnum.d23a2dc2.js";import{u as Ve}from"./useCopyToClipboard.02dee7c2.js";import{q as ye,s as Ge}from"./index.b2a7a6f0.js";/* empty css               *//* empty css              */var F;(function(o){o.GetCategoryTree="/updatemonitor/dict-index/categoryTree",o.GetDirTemplate="/template/templateByCategory",o.GetTemplate="/template/templateQuery"})(F||(F={}));var _e;(function(o){o[o.sys=0]="sys",o[o.user=1]="user",o[o.all=2]="all"})(_e||(_e={}));function $e(o){return ue.get({url:F.GetCategoryTree,params:o})}function ze(o){return ue.get({url:F.GetDirTemplate,params:o})}const{t:Qe}=A();function Xe(o){const s=[];function t(f,r){const m=f.children.find(c=>(Reflect.deleteProperty(c,"class"),c.id===r));m.class=o,s.push(m)}function g(){s.forEach(f=>{Reflect.deleteProperty(f,"class")}),ee(s,f=>f)}function e(f){f.class=o,s.push(f)}return[s,{setHighLight:t,clearHightLight:g,insertHightListNode:e}]}function We({onSingleSelect:o}){const s=[];let t;const g=o;function e(c){t=c}function f(){ee(s,c=>c)}function r(){return te(s)}function m({e:{nativeEvent:c,node:{eventKey:y,dataRef:a}},allowMultiSelect:C}){const E=te(s);if(c.ctrlKey&&C){const v=E.indexOf(y);v>-1?s.splice(v,1):s.push(y)}else if(c.shiftKey&&C){let v=999,S=0;const L=fe(t,b=>b.id===a.categoryId).children;for(let b=0;b<s.length;b++)v=Math.min(L.findIndex(T=>T.key===s[b]),v),S=Math.max(L.findIndex(T=>T.key===s[b]),S);const x=L.findIndex(b=>b.key===y);x<v&&(v=x),x>S&&(S=x);for(let b=v;b<=S;b++){const T=L[b].key;s.indexOf(T)===-1&&s.push(T)}}else f(),s.push(y),g&&g({dataRef:a,allowMultiSelect:C})}return[s,{insertMultiSelectedKey:m,setTreeData:e,clearMultiSelected:f,getMultiList:r}]}function Je(){const o={[D.HUIChart]:e=>e.name,[D.PROChart]:e=>e.name,[D.PINGChart]:e=>`[${Qe("template.compatible")}]${e.name}`};function s(e){return o[e.version].call(null,e)}const t={[D.HUIChart]:"ant-design:line-chart-outlined",[D.PINGChart]:"ant-design:area-chart-outlined",[D.PROChart]:"mdi:chart-areaspline"};function g(e){return t[e.version]}return{getTemplateIcon:g,getTemplateName:s}}function Ye(){const o=[{name:"\u9ED8\u8BA4\u914D\u8272",colors:["#85c1e9","#b2b4c3","#1f74ad","#ee8f71","#a5251c","#f15c80","#e4d354","#8085e8","#8d4653","#91e8e1"]},{name:"Hichart\u914D\u8272",colors:["#7cb5ec","#90ed7d","#f7a35c","#8085e9","#f15c80","#e4d354","#8085e8","#8d4653","#91e8e1"]},{name:"MX Gray",colors:["#bdbdbd","#747474","#bd9c5e","#d2826d","#731714"]},{name:"MX Blue",colors:["#bdbdbd","#75b9e6","#003661","#eb815f"]},{name:"\u78A7\u6D77\u84DD\u5929",colors:["#0f6fc6","#009dd9","#0bd0d9","#eb815f","#7cca62","#f49100"]},{name:"\u6570\u636E\u84DD\u7070",colors:["#2a3d52","#c4af99","#5b6c83","#d7ccb8","#38526e","#bfbfbf"]},{name:"\u5B89\u5168\u8272",colors:["#e6836d","#2a3d52","#bfbfbf","#a5c3c3","#dcd0a8","#a1797f","#0b81c9"]},{name:"\u70ED\u5B63\u98CE",colors:["#a53005","#e19825","#d55816","#b18c7d","#7f5f52","#b27d49"]},{name:"\u6E05\u6DE1\u8272",colors:["#bfbfbf","#dcd0a8","#91e8e1","#e4d354","#91e8e1","#85c1e9","#8085e8","#a1797f"]}],s={series:"normal",season:"seasonal",curve:"structural",polar_quantile:"quantile",polar:"radar",pie:"pie",column:"bar",boxplot:"boxplot",datatable:""},t={line:"line",spline:"smoothLine",area:"area",column:"bar",bar:"bar",pie:"line",treemap:"line",scatter:"scatter"};return function(e){var c;const f=e.rows,r={category_id:e.category_id,config:{name:e.template_name,type:s[e.option_template_type],title:e.chart_title,quotaList:[],seriesSetting:[],colorSchemeId:22,selfColorScheme:o[e.option_chart_color].colors.join(","),valueFormatter:{normalized:e.option_normalize,afterDot:2,sortMonth:[]},showLastest:!0,showHighest:!1,timeConfig:{startDate:"2015-01-01",endDate:Ae(),type:Be.default},yAxis:[]}};if(r.config.type=="seasonal"){const y=e.season_begin_month?+e.season_begin_month:1;r.config.timeConfig.startMonth=y;const a=new Array(12).map((E,v)=>v+1),C=e.season_months&&e.season_months.length>0?e.season_months:new Array(12).map((E,v)=>v+1);r.config.timeConfig.sortMonth=ae(a,C)}else if(r.config.type=="structural")r.config.structuralOffset="30,15,7,1,0",r.config.structuralOffsetUnit=ge.natureDay;else if(r.config.type=="quantileRadar"){const y=e.quantile_years&&e.quantile_years.length>0?e.quantile_years:[1,3,5,10];r.config.quantileOffset=y.join(",")}else["radar","bar"].includes(r.config.type)?(r.config.timeConfig.pastValue=3,r.config.timeConfig.pastUnit=ye.last):r.config.type==="pie"&&(r.config.timeConfig.pastValue=1,r.config.timeConfig.pastUnit=ye.last);let m=[];for(let y=0;y<f.length;y++){const a=f[y];Reflect.has(a,"formula")&&Reflect.deleteProperty(a,"formula"),(a.yaxis==1||a.yaxis==2)&&(m=m.length>0?m:[{position:"left",max:void 0,min:void 0,offset:0,inverse:!1,axisLabel:{formatter:"{value}"}}],m.push({position:"right",min:a.ymin?+a.ymin:void 0,max:a.ymax?+a.ymax:void 0,offset:0,inverse:a.yaxis==2,axisLabel:{formatter:"{value}"}})),a.id&&a.id>1e8&&Reflect.deleteProperty(a,"id"),(c=r.config.quotaList)==null||c.push({name:a.name,sourceCode:a.source_code,sourceType:a.source_type,dateLast:a.date_first,frequency:a.frequency,unit:a.unit,shortName:a.shortName,selected:!0,id:a.id,timeLastUpdate:""}),r.config.seriesSetting.push({seriesType:t[a.chart_type],yAxisIndex:a.yaxis==1||a.yaxis==2?m.length-1:0,size:2,name:a.name})}return r.config.yAxis=m.length>0?m:[{inverse:!1,offset:0,position:"left",axisLabel:{formatter:"{value}"}}],r.config}}function Ze(){return function(s){const t=s.config,g={title:t.title,name:t.title,type:t.type,colorSchemeId:t.colorsId,selfColorScheme:t.colors,showLastest:t.textRect.showLastest,showHighest:t.textRect.showHighest,timeConfig:{startDate:t.startDate,endDate:t.endDate,type:t.titleType},valueFormatter:{afterDot:t.decimal,normalized:t.normalized},yAxis:t.multiY?t.yAxis.map(e=>Y(J({},e),{axisLabel:{formatter:"{value}"}})):[{inverse:!1,offset:0,position:"left",axisLabel:{formatter:"{value}"}}]};if(t.lastMulti.multi&&(g.timeConfig.pastValue=t.lastMulti.number),t.structXLabel.ifStruct&&(g.structuralOffset=t.structXLabel.list.map(e=>e.value).join(","),g.structuralOffsetUnit=ge.natureDay),t.sortMonth.ifSortMonth){const e=new Array(12).map((r,m)=>m+1),f=t.sortMonth.list;g.timeConfig.sortMonth=ae(e,f)}return t.quantile.ifQuantile&&(t.config.quantileOffset=t.quantile.list.map(e=>e.value).join(",")),g.seriesSetting=[],g.quotaList=t.rows.map(e=>{const f=Ne(e,["show","seriesCfg"]);return f.selected=e.show||e.selected,g.seriesSetting.push({yAxisIndex:e.seriesCfg.yAxisIndex,size:e.seriesCfg.lineWidth,seriesType:e.seriesCfg.type}),f}),g}}function et(){return{pingChart:Ye(),huiChart:Ze()}}const tt={class:"bg-white tail"},at=["data-folderId","data-LeafId"],st=se({props:{showSearch:{type:Boolean}},emits:["selectNode","selectFolder"],setup(o,{emit:s}){const t=o,{showSearch:g}=ke(t),e="select-hightlight",f=ne.TabPane,{t:r}=A(),{createMessage:m}=me(),c=M(_.sysTemplate),{getTemplateIcon:y,getTemplateName:a}=Je(),{pingChart:C,huiChart:E}=et(),v=n=>Reflect.has(n,"folder")&&n.folder;function S(n){const u="ant-design:folder-outlined";return v(n)?u:y(n)}function L(n){return Reflect.has(n,"version")?a(n):n.name}const x=oe({[_.sysTemplate]:{treeData:[],replaceFields:{title:"name"},blockNode:!0,clickRowToExpand:!0,loadData:({eventKey:n})=>j(n),beforeRightClick:Q},[_.userTemplate]:{treeData:[],replaceFields:{title:"name"},blockNode:!0,clickRowToExpand:!0,loadData:({eventKey:n})=>j(n),beforeRightClick:Q}}),b=oe({[_.sysTemplate]:!1,[_.userTemplate]:!1});async function T(n=l(c)){var p;b[c.value]=!0;const u=((p=q(c.value))==null?void 0:p.getExpandedKeys())||null;try{const h=await $e({type:n});pe(h,i=>{i.isLeaf=!i.folder,i.slots={title:"title"},i.icon="flat-color-icons:folder",u&&u.includes(i.key)&&!i.children&&j(i.key)}),x[n].treeData=h,m.success(r("sys.api.getOK"))}catch{m.error(r("sys.api.getFailed"))}finally{he(()=>{b[c.value]=!1},960)}}const P=M(),H=M();function q(n){if(n===_.sysTemplate&&l(P))return l(P);if(n===_.userTemplate&&l(H))return l(H);throw new Error("tree instance did not inited or mounted!")}async function j(n){const u=l(c.value),p=q(u),h=await ze({categoryId:n,type:u}),{parentNode:i}=V(n,u);i.children=h.map(d=>{const I=JSON.parse(d.options);return Reflect.has(I,"config")?(d.version=D.HUIChart,d.config=E(I),d.name=d.config.name):Reflect.has(I,"option_template_type")?(d.version=D.PINGChart,d.config=C(I)):d.version=D.PROChart,d.icon=S(d),d.slots={title:"title"},d.isLeaf=!0,d.key=d.id,d.categoryId=n,d}),p==null||p.setExpandedKeys(re([n,...p.getExpandedKeys()]))}const[O,{setHighLight:B,clearHightLight:K,insertHightListNode:be}]=Xe(e);function V(n,u){function p(){return[fe(x[u||c.value].treeData,d=>d.id===n),q(u||c.value)]}let[h,i]=p();return h||(c.value=c.value===_.sysTemplate?_.userTemplate:_.sysTemplate,[h,i]=p()),{parentNode:h,instance:i}}async function ve(n,u){const p=parseInt(n.match(/\[(\d+)\](.+)/i)[1]);K();const{parentNode:h,instance:i}=V(u.categoryId);if(h.children&&h.children.length>0)B(h,p);else{await j(h.id);const d=Ue(x[_.sysTemplate].treeData,I=>I.id===h.id).map(I=>I.id);i==null||i.setExpandedKeys(re([...d,...i.getExpandedKeys()])),B(h,p)}await Fe(),i.$el.getElementsByClassName(e)[0].scrollIntoView({behavior:"smooth",block:"center"})}const[rt,{insertMultiSelectedKey:xe,clearMultiSelected:Te,setTreeData:Ce,getMultiList:G}]=We({onSingleSelect:({dataRef:n,allowMultiSelect:u})=>{u?s("selectNode",Pe(n,["config","id","categoryId","version"])):s("selectFolder",n)}});function $(n,u){u.node.dataRef.folder&&(u.node.dataRef.icon=u.node.expanded?"flat-color-icons:opened-folder":"flat-color-icons:folder");const p=q(c.value);Ce(x[c.value].treeData);const h=!v(u.node.dataRef);xe({e:u,allowMultiSelect:h}),K();const i=G();pe(x[c.value].treeData,d=>{i.includes(d.key)&&be(d)}),p==null||p.setSelectedKeys(i)}function z(n){const{isSuccessRef:u}=Ve(n);u.value?m.success(r("quota.actionsRes.copyOK")):m.success(r("quota.actionsRes.copyFailed"))}function Q({dataRef:n}){G().includes(n.id)||(Te(),K());const p=[{label:r("template.actions.copyID"),icon:"",handler:()=>{z(n.id.toString())}},{label:r("template.actions.copyName"),icon:"",handler:()=>z(n.name)}];return v(n)?[...p]:[...p,{label:r("template.actions.multiSelectQuota"),icon:"",handler:()=>{console.log(O);for(let i=0;i<O.length;i++){const d=O[i];he(()=>{s("selectNode",d)},300*i)}}}]}return Ee(()=>{T(_.sysTemplate),T(_.userTemplate)}),(n,u)=>{const p=ie("repeat-click"),h=ie("loading");return w(),Me("div",tt,[l(g)?(w(),R(l(ot),{key:0,onSelect:ve})):Re("",!0),le(N(l(U),{class:"refresh-icon",icon:"ant-design:sync-outlined",spin:l(b)[l(_).sysTemplate]},null,8,["spin"]),[[p,T]]),N(l(ne),{activeKey:c.value,"onUpdate:activeKey":u[0]||(u[0]=i=>c.value=i),class:"tabs",centered:""},{default:k(()=>[(w(),R(l(f),{key:l(_).sysTemplate,tab:l(r)("template.sysTemplate")},{default:k(()=>[le((w(),R(l(Z),ce(l(x)[l(_).sysTemplate],{ref_key:"sysTree",ref:P,onSelect:$}),{title:k(i=>[N(l(U),{icon:i.icon},null,8,["icon"]),qe("span",{class:"select-none tree-node w-full","data-folderId":i.folder?i.key:void 0,"data-LeafId":i.folder?void 0:i.key},je(L(i)),9,at)]),_:1},16)),[[h,l(b)[l(_).sysTemplate]]])]),_:1},8,["tab"])),(w(),R(l(f),{key:l(_).userTemplate,tab:l(r)("template.userTemplate")},{default:k(()=>[N(l(Z),ce(l(x)[l(_).userTemplate],{ref_key:"userTree",ref:H,onSelect:$}),null,16)]),_:1},8,["tab"]))]),_:1},8,["activeKey"])])}}});var bt=de(st,[["__scopeId","data-v-288256cc"]]);const nt=se({emits:["select"],setup(o,{emit:s}){const{t}=A(),{createMessage:g}=me(),e=M(""),f=M([]);async function r(y){f.value=[];try{f.value=(await Ge({key:y})).map(a=>({label:a.shortName||a.name,value:`[${a.id}]${a.shortName||a.name}`,categoryId:a.categoryId}))}catch{g.warn(t("common.searchResEmpty"))}}const m=Ke(r,800);function c(y,a){s("select",y,a)}return(y,a)=>(w(),R(l(Oe),{class:"w-full search-on",value:e.value,"onUpdate:value":a[0]||(a[0]=C=>e.value=C),placeholder:l(t)("component.search.searchQuota"),onSearch:l(m),onSelect:c,options:f.value},{default:k(()=>[N(l(He),null,{suffix:k(()=>[N(l(U),{icon:"ic:twotone-search"})]),_:1})]),_:1},8,["value","placeholder","onSearch","options"]))}});var ot=de(nt,[["__scopeId","data-v-1f85cf99"]]);export{bt as T};
