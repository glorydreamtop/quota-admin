import{D as U,R as H,r as T,F as Q,a3 as M,a9 as m,K as h,G as Y,ac as Ke,v as p,u as e,L as S,ab as pe,bU as Ne,aj as G,O as ye,P as he,aU as je,bH as ge,Y as ve,bd as _e,j as me,V as xe,a$ as De,B as Pe,a0 as Ae,m as we,ba as Qe,ae as He,H as B,J as O,aJ as J,ad as Ye,a1 as Oe,bx as Ve,W as ze,N as Ge}from"./vendor.1ce5b3a9.js";import{u as Je,_ as We,a as Xe,b as Ze,c as ea}from"./AdvanceSearch.vue_vue_type_style_index_0_scoped_true_lang.67b3765a.js";/* empty css               */import{b as Ie,B as be,a as W}from"./index.fa044461.js";import{_ as K,b as V,I as C,aK as aa,al as ta,h as X,ak as oa,am as Z,an as sa}from"./index.b82b58bf.js";import{_ as ke}from"./Tree.vue_vue_type_style_index_0_lang.cb42af18.js";/* empty css               *//* empty css               *//* empty css               */import{d as na,g as la,r as ra,a as ca,b as da,m as ia,c as ua,u as fa,s as pa}from"./index.ed64d4ee.js";import{C as d}from"./quotaEnum.42e6645f.js";import{u as qe}from"./useTimeout.9c582638.js";import{u as ya}from"./useCopyToClipboard.c08f35cc.js";/* empty css               *//* empty css              */import"./useForm.0685912e.js";/* empty css                */import"./index.7349df9f.js";const ha=v=>(ye("data-v-35446244"),v=v(),he(),v),ga={class:"flex flex-col items-center min-w-100"},va={class:"border-dashed border-2 w-4/5 px-4 py-6 flex justify-between"},_a={class:"whitespace-nowrap"},ma=ha(()=>h("div",{class:"container"},[h("div",{class:"wave"}),h("span",{class:"text"},"\u6682\u4E0D\u53EF\u7528")],-1)),xa=U({setup(v){const{t:y}=V(),[D]=Ie(()=>{}),u=H({title:y("quota.quotaUpload.importQuota"),width:"40rem",showOkBtn:!1,showCancelBtn:!1,canFullscreen:!1}),I=T([{icon:"ant-design:file-excel-filled",name:y("quota.quotaUpload.quotaExcel"),link:"http://121.4.186.36:23588/cms/downloadFile?fileKey=files/\u6307\u6807\u5BFC\u5165\u6A21\u677F.xlsx"},{icon:"ant-design:file-excel-outlined",name:y("quota.quotaUpload.quotaDataExcel1"),link:"http://115.159.126.104/download/files/%E6%95%B0%E6%8D%AE%E5%AF%BC%E5%85%A5%E6%A8%A1%E6%9D%BF.xlsx"},{icon:"ant-design:file-excel-outlined",name:y("quota.quotaUpload.quotaDataExcel2"),link:"http://121.4.186.36:23588/cms/downloadFile?fileKey=files/\u4E07\u5F97\u6570\u636E\u5BFC\u5165\u6A21\u677F.xlsx"},{icon:"ant-design:file-excel-outlined",name:y("quota.quotaUpload.quotaDataExcel3"),link:"http://121.4.186.36:23588/cms/downloadFile?fileKey=files/\u94A2\u8054\u6570\u636E\u5BFC\u5165\u6A21\u677F.xlsx"}]);return(w,k)=>(Q(),M(e(be),G(e(u),{onRegister:e(D)}),{default:m(()=>[h("div",ga,[h("div",va,[(Q(!0),Y(pe,null,Ke(I.value,l=>(Q(),Y("div",{class:"flex flex-col items-center w-10em cursor-pointer",key:l.name},[p(e(C),{class:"!text-4xl !text-primary",icon:l.icon},null,8,["icon"]),h("span",_a,S(l.name),1)]))),128))]),p(e(Ne),{class:"mt-6 relative h-100px"},{default:m(()=>[ma]),_:1})])]),_:1},16,["onRegister"]))}});var Da=K(xa,[["__scopeId","data-v-35446244"]]);const wa=v=>(ye("data-v-6d7d0eea"),v=v(),he(),v),Qa={class:"flex flex-col items-center gap-1"},Ia={class:"text-primary"},ba={class:""},ka={class:"picker"},qa=wa(()=>h("span",null,"~",-1)),Ta=U({setup(v){const{t:y}=V(),{createMessage:D}=X(),u=H({startDate:aa(1),endDate:ta(),quota:{},loading:!1}),[I,{setModalProps:w,closeModal:k}]=Ie(_=>{w({canFullscreen:!1,height:80,minHeight:80,width:300,okText:y("quota.actions.clearData"),okButtonProps:{loading:u.loading}}),u.quota=_});async function l(){try{await na({indexId:u.quota.id,startDate:u.startDate,endDate:u.endDate}),D.success(y("sys.api.delOK")),k()}catch(_){D.error(_)}}return(_,x)=>(Q(),M(e(be),{onRegister:e(I),onOk:l,dialogStyle:{left:"-30%",top:"40%"}},{default:m(()=>[h("div",Qa,[h("span",null,[h("span",Ia,S(e(u).quota.name),1),je(S(`,${e(y)("quota.actions.delQuotaDataInfo.amount")}${e(u).quota.rowsCount}${e(y)("quota.actions.delQuotaDataInfo.rowsCount")}`),1)]),h("span",ba,S(e(y)("quota.actions.delQuotaDataTip")),1),h("div",ka,[p(e(ge),{value:e(u).startDate,"onUpdate:value":x[0]||(x[0]=c=>e(u).startDate=c),"value-format":"YYYY-MM-DD"},{default:m(()=>[h("span",null,S(e(u).startDate),1)]),_:1},8,["value"]),qa,p(e(ge),{value:e(u).endDate,"onUpdate:value":x[1]||(x[1]=c=>e(u).endDate=c),"value-format":"YYYY-MM-DD"},{default:m(()=>[h("span",null,S(e(u).endDate),1)]),_:1},8,["value"])])])]),_:1},8,["onRegister"]))}});var Sa=K(Ta,[["__scopeId","data-v-6d7d0eea"]]);const Ca=["data-folderId","data-LeafId"],Ea=["data-folderId","data-LeafId"],Fa=["data-folderId","data-LeafId"],Ma=["data-folderId","data-LeafId"],Ba=U({props:{showSearch:{type:Boolean}},emits:["selectNode","selectFolder"],setup(v,{emit:y}){const D=v,u=T(),{showSearch:I}=ve(D),w="select-hightlight",k=_e.TabPane,{t:l}=V(),{createMessage:_,createConfirm:x}=X(),c=Je(),i=T(d.sysQuota),z=a=>Reflect.has(a,"folder")&&a.folder;function ee(a){return z(a)?a.name:`[${a.id}]${a.shortName||a.name}`}const g=H({[d.sysQuota]:{treeData:[],replaceFields:{title:"name"},blockNode:!0,clickRowToExpand:!0,loadData:({eventKey:a})=>R(a),beforeRightClick:de,treeInstance:me(()=>j.value),showLine:!1},[d.userQuota]:{treeData:[],replaceFields:{title:"name"},blockNode:!0,clickRowToExpand:!0,loadData:({eventKey:a})=>R(a),beforeRightClick:de,treeInstance:me(()=>P.value),showLine:!1}});xe(()=>g[d.sysQuota].treeData,a=>{c.setSysQuotaTree(a)},{deep:!0}),xe(()=>g[d.userQuota].treeData,a=>{c.setUserQuotaTree(a)},{deep:!0});const N=H({[d.sysQuota]:!1,[d.userQuota]:!1});async function q(a=e(i)){var n;N[i.value]=!0;const o=((n=$(i.value))==null?void 0:n.getExpandedKeys())||null;try{const t=await da({type:a});Z(t,s=>{var f;s.isLeaf=!s.folder,s.slots={title:"title"},s.icon=s.folder?"flat-color-icons:folder":"flat-color-icons:file",o&&o.includes(s.key)&&(((f=s.children)==null?void 0:f.every(r=>r.folder))||!s.children)&&R(s.key)}),g[a].treeData=t,_.success(l("sys.api.getOK"))}catch{_.error(l("sys.api.getFailed"))}finally{qe(()=>{N[i.value]=!1},960)}}const j=T(),P=T();function $(a){if(a===d.sysQuota&&e(j))return e(j);if(a===d.userQuota&&e(P))return e(P);throw new Error("tree instance did not inited or mounted!")}async function R(a){const o=e(i.value),n=$(o),t=await la({categoryId:a}),{parentNode:s}=A(a,o),f=t.map(r=>(r.icon="flat-color-icons:file",r.isLeaf=!0,r.key=r.id,r.slots={title:"title"},r.categoryId=a,r));s.children?s.children.push(...f):s.children=f,n==null||n.setExpandedKeys(De([a,...n.getExpandedKeys()]))}const[b,{setHighLight:ae,clearHightLight:L,insertHightListNode:te}]=Xe(w);function A(a,o){function n(){return[oa(g[o||i.value].treeData,f=>f.id===a),$(o||i.value)]}let[t,s]=n();return t||(i.value=i.value===d.sysQuota?d.userQuota:d.sysQuota,[t,s]=n()),{parentNode:t,instance:s}}async function Te(a,o){const n=parseInt(a.match(/\[(\d+)\](.+)/i)[1]);L();const{parentNode:t,instance:s}=A(o.categoryId);if(t.children&&t.children.length>0)ae(t,n);else{await R(t.id);const f=sa(g[d.sysQuota].treeData,r=>r.id===t.id).map(r=>r.id);s==null||s.setExpandedKeys(De([...f,...s.getExpandedKeys()])),ae(t,n)}await Oe(),s.$el.getElementsByClassName(w)[0].scrollIntoView({behavior:"smooth",block:"center"})}const[Na,{insertMultiSelectedKey:Se,clearMultiSelected:Ce,setTreeData:Ee,getMultiList:oe}]=Ze({onSingleSelect:({dataRef:a,allowMultiSelect:o})=>{y(o?"selectNode":"selectFolder",a)}});async function se(a,o){var f;if(o.node.dataRef.folder&&(o.node.dataRef.icon=o.node.expanded?"flat-color-icons:opened-folder":"flat-color-icons:folder"),((f=o.node.dataRef.children)==null?void 0:f.every(r=>r.folder))&&o.node.expanded){try{await R(o.node.eventKey)}catch{}return}const n=$(i.value);Ee(g[i.value].treeData);const t=!z(o.node.dataRef);Se({e:o,allowMultiSelect:t}),L();const s=oe();Z(g[i.value].treeData,r=>{s.includes(r.key)&&te(r)}),n==null||n.setSelectedKeys(s)}function ne(a){const{isSuccessRef:o}=ya(a);o.value?_.success(l("quota.actionsRes.copyOK")):_.success(l("quota.actionsRes.copyFailed"))}const E=T(),{addFolder:Fe,saveCategory:Me,delCategory:Be}=ea({tree:g,treeType:i});async function le(a){await Me(a),E.value=0,await q()}const[$e,{openModal:re,setModalProps:ce}]=W(),[Le,{openModal:Re}]=W();function de({dataRef:a}){const o=oe();o.includes(a.id)||(Ce(),L());const n=[{label:l("quota.actions.copyID"),icon:"",handler:()=>{ne(a.id.toString())}},{label:l("quota.actions.copyName"),icon:"",handler:()=>ne(a.name)}];return z(a)?[...n,{label:l("quota.actions.rename"),icon:"",handler:()=>{E.value=a.id}},{label:l("quota.actions.addFolder"),icon:"",handler:()=>{E.value=0,Fe(a)}},{label:l("quota.actions.addQuota"),icon:"",handler:()=>{ce({afterClose(){q()}}),re(!0,{categoryId:a.id})}},{label:l("quota.actions.delFolder"),icon:"",handler:async()=>{try{await Be(a),await q()}catch{}}}]:[...n,{label:l("quota.actions.editQuota"),icon:"",handler:()=>{ce({afterClose(){q()}}),re(!0,a)}},{label:l("quota.actions.multiSelectQuota"),icon:"",disabled:b.length===0,handler:()=>{for(let s=0;s<b.length;s++)qe(()=>{var f;y("selectNode",b[s]),s===b.length-1&&(L(),(f=$(i.value))==null||f.setSelectedKeys([]))},s*30)}},{label:l("quota.actions.multiUpdateQuota"),icon:"",handler:async()=>{var s;try{const{msg:f}=await ra({categoryId:a.categoryId,indexIdList:o});_.success(f)}catch(f){_.error(f)}finally{L(),(s=$(i.value))==null||s.setSelectedKeys([])}}},{label:l("quota.actions.clearData"),icon:"",handler:()=>{Re(!0,a)}},{label:l("quota.actions.delQuota"),icon:"",handler:()=>{x({iconType:"warning",okButtonProps:{danger:!0},content:Pe("span",{},l("quota.actions.delQuotaTip")),onOk:async()=>{await ca({indexId:a.id}),q()}})}}]}function ie({node:a}){b.some(o=>o.key===a.dataRef.id)||(L(),Z(g[i.value].treeData,o=>{o.key===a.dataRef.id&&te(o)}))}async function ue({event:a,node:o}){if(b.every(n=>!n.folder))if(o.dataRef.folder){const n=b.map(t=>t.id);await ia({categoryId:o.dataRef.id,indexIdList:n})}else{const{top:n,bottom:t}=a.toElement.getBoundingClientRect(),s=a.pageY<(t+n)/2,{parentNode:f}=A(o.dataRef.categoryId),r=f.children.map(F=>F.id),fe=r.findIndex(F=>F===o.dataRef.id);r==null||r.splice(s?fe:fe+1,0,...b.map(F=>F.id)),await ua({categorySortingList:r.map((F,Ue)=>({id:F,sorting:Ue+1})),type:i.value})}else{if(!o.dataRef.folder)return;const{parentNode:n}=A(o.dataRef.id);await fa({id:b[0].id,name:b[0].name,parentId:n.id})}q()}return Ae(()=>{var a,o;g[d.sysQuota].treeData=we(c.geteSysQuotaTree),g[d.userQuota].treeData=we(c.geteUserQuotaTree),((a=g[d.sysQuota].treeData)==null?void 0:a.length)===0&&q(d.sysQuota),((o=g[d.userQuota].treeData)==null?void 0:o.length)===0&&q(d.userQuota)}),(a,o)=>{const n=Qe("loading");return Q(),Y("div",{class:"bg-white tail",ref_key:"quotaTreeRef",ref:u},[e(I)?(Q(),M(e(La),{key:0,onSelect:Te})):He("",!0),p(e(Ka),{loading:e(N)[i.value],onGetData:q},null,8,["loading"]),p(e(We),{onRegister:e($e)},null,8,["onRegister"]),p(Sa,{onRegister:e(Le)},null,8,["onRegister"]),p(e(_e),{activeKey:i.value,"onUpdate:activeKey":o[1]||(o[1]=t=>i.value=t),class:"tabs",centered:""},{default:m(()=>[(Q(),M(e(k),{key:e(d).sysQuota,tab:e(l)("quota.sysQuota")},{default:m(()=>[B((Q(),M(e(ke),G(e(g)[e(d).sysQuota],{ref_key:"sysTree",ref:j,draggable:"",onDragstart:ie,onDrop:ue,onSelect:se}),{switcherIcon:m(()=>[p(e(C),{style:{opacity:"0.3"},icon:"ant-design:down-outlined"})]),title:m(t=>[h("span",{class:"w-full","data-folderId":t.folder?t.key:void 0,"data-LeafId":t.folder?void 0:t.key},[p(e(C),{class:"-ml-1 mr-1",icon:t.icon},null,8,["icon"]),B(h("span",{"data-folderId":t.folder?t.key:void 0,"data-LeafId":t.folder?void 0:t.key,class:"select-none tree-node w-full"},S(ee(t)),9,Ea),[[O,t.key!==E.value]]),B(p(e(J),{class:"name-editor",size:"small",value:t.name,"onUpdate:value":s=>t.name=s,onClick:o[0]||(o[0]=Ye(()=>{},["stop"])),onBlur:s=>le(t),autofocus:""},null,8,["value","onUpdate:value","onBlur"]),[[O,t.key===E.value]])],8,Ca)]),_:1},16)),[[n,e(N)[e(d).sysQuota]]])]),_:1},8,["tab"])),(Q(),M(e(k),{key:e(d).userQuota,tab:e(l)("quota.userQuota")},{default:m(()=>[p(e(ke),G(e(g)[e(d).userQuota],{ref_key:"userTree",ref:P,draggable:"",onDragstart:ie,onDrop:ue,onSelect:se}),{switcherIcon:m(()=>[p(e(C),{style:{opacity:"0.3"},icon:"ant-design:down-outlined"})]),title:m(t=>[h("span",{class:"w-full","data-folderId":t.folder?t.key:void 0,"data-LeafId":t.folder?void 0:t.key},[p(e(C),{class:"-ml-1 mr-1",icon:t.icon},null,8,["icon"]),B(h("span",{"data-folderId":t.folder?t.key:void 0,"data-LeafId":t.folder?void 0:t.key,class:"select-none tree-node w-full"},S(ee(t)),9,Ma),[[O,t.key!==E.value]]),B(p(e(J),{class:"name-editor",size:"small",value:t.name,"onUpdate:value":s=>t.name=s,onBlur:s=>le(t),autofocus:""},null,8,["value","onUpdate:value","onBlur"]),[[O,t.key===E.value]])],8,Fa)]),_:1},16)]),_:1},8,["tab"]))]),_:1},8,["activeKey"])],512)}}});var nt=K(Ba,[["__scopeId","data-v-34eee34c"]]);const $a=U({emits:["select"],setup(v,{emit:y}){const{t:D}=V(),{createMessage:u}=X(),I=T(""),w=T([]);async function k(x){w.value=[];try{w.value=(await pa({key:x})).map(c=>({label:c.shortName||c.name,value:`[${c.id}]${c.shortName||c.name}`,categoryId:c.categoryId}))}catch{u.warn(D("common.searchResEmpty"))}}const l=ze(k,800);function _(x,c){y("select",x,c)}return(x,c)=>(Q(),M(e(Ve),{class:"w-full search-on",value:I.value,"onUpdate:value":c[0]||(c[0]=i=>I.value=i),placeholder:e(D)("component.search.searchQuota"),onSearch:e(l),onSelect:_,options:w.value},{default:m(()=>[p(e(J),null,{suffix:m(()=>[p(e(C),{icon:"ic:twotone-search"})]),_:1})]),_:1},8,["value","placeholder","onSearch","options"]))}});var La=K($a,[["__scopeId","data-v-0da58791"]]);const Ra={class:"toolbar"},Ua=U({props:{loading:{type:Boolean}},emits:["getData"],setup(v,{emit:y}){const D=v,{loading:u}=ve(D),[I,{openModal:w}]=W();function k(){y("getData")}function l(){w(!0)}return(_,x)=>{const c=Qe("repeat-click");return Q(),Y(pe,null,[h("div",Ra,[B(p(e(C),{class:Ge(["cursor-pointer !text-purple-600 animate__animated",e(u)?" animate__flash":""]),size:20,icon:"CloudSync|svg"},null,8,["class"]),[[c,k]]),B(p(e(C),{class:"cursor-pointer !text-purple-600",size:20,icon:"ant-design:cloud-upload-outlined"},null,512),[[c,l]])]),p(e(Da),{onRegister:e(I)},null,8,["onRegister"])],64)}}});var Ka=K(Ua,[["__scopeId","data-v-e1eb1de8"]]);export{nt as Q};
