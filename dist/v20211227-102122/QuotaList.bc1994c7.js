import{D as W,r as b,a1 as G,u as o,ba as J,F as y,G as k,K as r,v as l,a9 as i,aU as x,L as d,aH as g,ah as m,ab as K,ac as X,H as S,N as I,ad as v,J as Y,bf as Z,bv as D,m as ee}from"./vendor.2e1d877b.js";import{a as te}from"./index.f3cbd9f4.js";import{u as ae,t as oe}from"./commonHelper.b6c14153.js";import{_ as se,b as ne,I as h,al as le,aO as M,a2 as T,h as ie}from"./index.86e9d70c.js";import{u as re}from"./useSortable.4d32f3ca.js";import{u as de}from"./useCopyToClipboard.02dee7c2.js";import{u as ce}from"./useContextMenu.029884b8.js";import{R as ue}from"./index.ca28cf7e.js";import{o as pe}from"./onMountedOrActivated.9356963a.js";import{u as fe,e as me}from"./hooks.ebef14d1.js";import he from"./QuotaSetting.58b18aa5.js";import{r as xe}from"./index.b2a7a6f0.js";import{a as ve}from"./quotaEnum.42e6645f.js";import"./useTimeout.534f4a33.js";import"./useWindowSizeFn.752f6aa7.js";import"./index.0fb85ddd.js";import"http://at.alicdn.com/t/font_2948274_sdqssf53jp.js";import"./sortable.esm.c79628ac.js";/* empty css                */import"./uuid.4c14c5c2.js";const _e={class:"relative flex h-48 p-4 bg-white shadow-md min-h-48"},ge={class:"flex flex-wrap w-auto gap-2 pr-2 border-r border-gray-300 write-vertical-left pt-2px"},we=["onClick","onContextmenu","data-quotaId"],Ce=["onDblclick"],qe={class:"text-white cursor-default select-none quota-title"},be=["onDblclick"],ye={class:"max-w-full overflow-x-hidden text-white cursor-default cursor-pointer select-none overflow-ellipsis quota-sourceCode"},ke=["onDblclick"],Ie={class:"flex justify-between text-purple-100 quota-unit-sourceType"},je={class:"flex justify-between text-purple-100 children:w-fit"},Ve={class:"text-xs"},Le={class:"del-icon"},Se=W({setup(De){const z=fe(),u=me(),{createMessage:_}=ie(),{t:n}=ne();function N(t){t.selected=!t.selected}const p=b(!0);function $(){p.value=!p.value}function F(){const t=u.value.every(a=>a.selected);u.value.forEach(a=>{a.selected=!t})}const C=b(!1);async function E(){const t={};u.value.forEach(s=>{s.selected&&!!s.id&&(Reflect.has(t,s.categoryId)?t[s.categoryId].push(s.id):t[s.categoryId]=[s.id])});const a=[];for(let s in t)a.push(xe({categoryId:parseInt(s),indexIdList:t[s]}));try{C.value=!0;const s=await Promise.allSettled(a);_.success(s[0].value.msg)}catch(s){_.error(s)}finally{C.value=!1}}ae(u,(t,a)=>{if(t.length>a.length)for(let s=0;s<t.length;s++)a.findIndex(e=>e.id===t[s].id)===-1&&(t[s].selected=!0);z.value=t.filter(s=>s.selected)});function q(t){return/formula/i.test(t.id.toString())}function B(t){return q(t)&&t.sourceType===ve.formula?n("quotaView.quotaCard.calculate"):t.dateLast===null?n("common.noData"):le(t.dateLast)}const[Q,{openModal:j,setModalProps:V}]=te();function A(){j(!0,{record:{},index:u.value.length}),V({title:n("quotaView.quotaSetting.formulaModalTitle"),minHeight:300,width:"400px"})}function U(){D(u.value,t=>t.selected===!0),_.success(n("quotaView.quotaCard.alldel"))}function R(t,a){({del:()=>{D(u.value,e=>e.id===t.id)}})[a]()}function w(t,a){if(a==="id"&&/formula/i.test(t))return;const s={name:n("quotaView.quotaCard.name"),id:n("quotaView.quotaCard.id"),sourceCode:n("quotaView.quotaCard.sourceCode"),shortName:n("quotaView.quotaCard.shortName")},{isSuccessRef:e}=de(t);o(e)&&_.success(`${s[a]}\u5DF2\u590D\u5236\u5230\u526A\u8D34\u677F`)}const[H]=ce();function O(t,a){const s=[{label:n("quotaView.quotaCard.contextMenu.edit"),icon:"ant-design:edit-outlined",handler:()=>{j(!0,{record:a,index:u.value.findIndex(e=>a.id===e.id)}),V({title:n("quotaView.quotaSetting.modalTitle"),minHeight:300})}},{label:n("quotaView.quotaCard.contextMenu.copyShortName"),icon:"ant-design:copy-outlined",handler:()=>{a.shortName?w(a.shortName.toString(),"shortName"):_.warning(n("quotaView.quotaCard.contextMenu.noShortName"))}},{label:n("quotaView.quotaCard.contextMenu.saveInMyFolder"),icon:"ant-design:folder-add-outlined",handler:()=>{const e=ee(a);Reflect.deleteProperty(e,"id"),e.categoryIdList=[]}}];H({event:t,items:s})}const L=b();return pe(async()=>{await G();const t=o(L).$el,{initSortable:a}=re(t,{handle:".drag-handler",draggable:".sortable",dataIdAttr:"data-quotaId",dragoverBubble:!0,onStart:()=>{M(t.getElementsByClassName("sortable"),s=>{s.classList.remove("quota-list-item","animate__animated","animate__zoomIn","animate__fast")})},onEnd:s=>{M(t.getElementsByClassName("sortable"),P=>{P.classList.add("quota-list-item")});const{oldIndex:e,newIndex:f}=s;if(T(e)||T(f)||e===f)return;const c=u.value;e>f?(c.splice(f,0,c[e]),c.splice(e+1,1)):(c.splice(f+1,0,c[e]),c.splice(e,1))}});a()}),(t,a)=>{const s=J("loading");return y(),k("div",_e,[r("div",ge,[l(o(m),{placement:"left"},{title:i(()=>[x(d(o(n)("quotaView.quotaList.formula")),1)]),default:i(()=>[l(o(g),{size:"small",onClick:A},{icon:i(()=>[l(o(h),{icon:"carbon:function-math",size:"20"})]),_:1})]),_:1}),l(o(m),{placement:"left"},{title:i(()=>[x(d(o(n)("quotaView.quotaList.delChecked")),1)]),default:i(()=>[l(o(g),{size:"small",onClick:U,"data-type":"delete",class:"delete-shake"},{icon:i(()=>[l(o(h),{icon:"ant-design:delete-outlined",size:"20"})]),_:1})]),_:1}),l(o(m),{placement:"left"},{title:i(()=>[x(d(o(n)("quotaView.quotaList.checkAll")),1)]),default:i(()=>[l(o(g),{size:"small",onClick:F},{icon:i(()=>[l(o(h),{icon:"ant-design:check-outlined",size:"20"})]),_:1})]),_:1}),l(o(m),{placement:"left"},{title:i(()=>[x(d(p.value?o(n)("quotaView.quotaList.listUI"):o(n)("quotaView.quotaList.cardUI")),1)]),default:i(()=>[l(o(g),{size:"small",onClick:$},{icon:i(()=>[l(o(h),{icon:"ant-design:swap-outlined",size:"20"})]),_:1})]),_:1}),l(o(m),{placement:"left"},{title:i(()=>[x(d(o(n)("quotaView.quotaList.updateQuota")),1)]),default:i(()=>[l(o(g),{size:"small",onClick:E},{icon:i(()=>[l(o(h),{icon:"ant-design:sync-outlined",size:"20"})]),_:1})]),_:1})]),l(Z,{tag:"div",name:"quota-list",class:I(["rounded-md overflow-y-scroll flex-grow relative pl-4",p.value?"flex gap-4 flex-wrap content-start":"w-0"]),ref_key:"quotaBox",ref:L},{default:i(()=>[(y(!0),k(K,null,X(o(u),(e,f)=>S((y(),k("div",{onClick:c=>N(e),onContextmenu:c=>O(c,e),class:I([e.selected?"bg-linear-primary":"bg-notselected",p.value?"card-theme":"list-theme","text-xs rounded-sm flex sortable quota-list-item"]),key:e.id,"data-quotaId":e.id},[r("span",{class:I(["flex items-center gap-1",p.value?"mb-1":""])},[l(o(h),{icon:"akar-icons:drag-horizontal",color:"#5eead4",class:"cursor-move drag-handler"}),r("span",{class:"text-purple-300 w-4em text-center cursor-pointer select-none",onClick:a[0]||(a[0]=v(()=>{},["stop"])),onDblclick:c=>w(e.id.toString(),"id")},d(q(e)?o(n)("quotaView.quotaCard.formulaWithoutId"):e.id),41,Ce)],2),S(r("span",{class:"text-gray-200 text-center"},d(`${f+1}`.padStart(2,"0")),513),[[Y,!p.value]]),l(o(m),{placement:p.value?"bottomLeft":"top"},{title:i(()=>[x(d(e.name),1)]),default:i(()=>[r("span",qe,[r("span",{class:"w-fit",onClick:a[1]||(a[1]=v(()=>{},["stop"])),onDblclick:c=>w(e.name,"name")},d(e.name),41,be)])]),_:2},1032,["placement"]),r("span",ye,[r("span",{class:"w-fit",onClick:a[2]||(a[2]=v(()=>{},["stop"])),onDblclick:c=>w(e.sourceCode,"sourceCode")},d(e.sourceCode),41,ke)]),r("span",Ie,[r("span",{class:"unit",onClick:a[3]||(a[3]=v(()=>{},["stop"]))},d(e.unit),1),r("span",{class:"sourceType",onClick:a[4]||(a[4]=v(()=>{},["stop"]))},d(o(oe)(e.sourceType)),1)]),r("span",je,[l(o(m),null,{title:i(()=>[r("span",Ve,d(q(e)?o(n)("quotaView.quotaCard.formulaTip"):`${o(n)("quotaView.quotaCard.updateOn")}${e.timeLastUpdate}`),1)]),default:i(()=>[r("span",{class:"w-fit whitespace-nowrap",onClick:a[5]||(a[5]=v(()=>{},["stop"]))},d(`${B(e)} ${e.frequency?`${e.frequency}\u66F4`:""}`),1)]),_:2},1024),r("span",Le,[l(o(h),{onClick:c=>R(e,"del"),class:"mr-1 cursor-pointer",icon:"ant-design:delete-outlined"},null,8,["onClick"])])])],42,we)),[[o(ue)],[s,C.value]])),128))]),_:1},8,["class"]),l(he,{onRegister:o(Q)},null,8,["onRegister"])])}}});var Ye=se(Se,[["__scopeId","data-v-023a48a3"]]);export{Ye as default};
